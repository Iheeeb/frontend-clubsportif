import{c as Q,a as R,j as r,U as Ie,C as ct,M as Qt,b as Gt,d as Kt,r as w,u as Zt,e as es}from"./index-Bs0fCrva.js";import{L as ts,M as be}from"./message-square-BkiXg1IG.js";import{P as ke,S as $e,X as ss}from"./x-xr3tIDqo.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],rs=Q("chart-column",ns);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],as=Q("check-check",is);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],cs=Q("check",os);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ds=Q("loader-circle",ls);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],hs=Q("search",us);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ms=Q("send",fs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Fe=Q("trash-2",ps);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],lt=Q("user-cog",gs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],dt=Q("user-x",ys);class xs{async getAll(){return R.get("/users")}async getById(e){return R.get(`/users/${e}`)}async create(e){return console.log("Creating user with data:",e),R.post("/users",e)}async update(e,t){return R.put(`/users/${e}`,t)}async delete(e){return R.delete(`/users/${e}`)}async getMembers(){return(await this.getAll()).filter(t=>t.role==="MEMBER")}async createMember(e){return console.log("Creating member with data:",e),this.create({...e,role:"MEMBER"})}async updateMember(e,t){return this.update(e,t)}async deleteMember(e){return this.delete(e)}async getCoaches(){return(await this.getAll()).filter(t=>t.role==="COACH")}async createCoach(e){return console.log("Creating coach with data:",e),this.create({...e,role:"COACH"})}async updateCoach(e,t){return this.update(e,t)}async deleteCoach(e){return this.delete(e)}async getAdmins(){return(await this.getAll()).filter(t=>t.role==="ADMIN")}}const Y=new xs;class bs{async getAll(){return R.get("/sessions")}async getById(e){return R.get(`/sessions/${e}`)}async create(e){return R.post("/sessions",e)}async update(e,t){return R.put(`/sessions/${e}`,t)}async delete(e){return R.delete(`/sessions/${e}`)}}const ge=new bs;class ws{async getAll(){return R.get("/field-reservations")}async getById(e){return R.get(`/field-reservations/${e}`)}async create(e){return R.post("/field-reservations",e)}async update(e,t){return R.put(`/field-reservations/${e}`,t)}async delete(e){return R.delete(`/field-reservations/${e}`)}}const Je=new ws;function vs({userName:s,onLogout:e}){return r.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:r.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-gray-900",children:"Tableau de bord Administrateur"}),r.jsxs("p",{className:"text-gray-600",children:["Bienvenue, ",s]})]}),r.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(ts,{className:"w-5 h-5"}),"Déconnexion"]})]})})}function Ns({currentView:s,onViewChange:e}){const t=[{id:"dashboard",icon:rs,label:"Tableau de bord",title:"Voir le tableau de bord général"},{id:"membres",icon:Ie,label:"Membres",title:"Gérer les membres"},{id:"coaches",icon:lt,label:"Coaches",title:"Gérer les coaches"},{id:"seances",icon:ct,label:"Séances",title:"Gérer les séances"},{id:"reservations",icon:Qt,label:"Réservations Terrain",title:"Gérer les réservations de terrain"},{id:"messages",icon:be,label:"Messages",title:"Voir les messages"}];return r.jsx("nav",{className:"lg:col-span-1",children:r.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 space-y-2",children:t.map(n=>{const i=n.icon;return r.jsxs("button",{onClick:()=>e(n.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${s===n.id?"bg-indigo-600 text-white":"text-gray-700 hover:bg-gray-100"}`,title:n.title,children:[r.jsx(i,{className:"w-5 h-5"}),n.label]},n.id)})})})}function js({membres:s,coaches:e,seances:t,reservations:n}){return r.jsxs("div",{className:"space-y-6",children:[r.jsx("h2",{className:"text-gray-900",children:"Vue d'ensemble"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600",children:"Membres actifs"}),r.jsx("p",{className:"text-gray-900 mt-1",children:s.filter(i=>i.status==="ACTIVE").length})]}),r.jsx(Ie,{className:"w-10 h-10 text-indigo-600"})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600",children:"Coaches"}),r.jsx("p",{className:"text-gray-900 mt-1",children:e.length})]}),r.jsx(lt,{className:"w-10 h-10 text-blue-600"})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600",children:"Séances à venir"}),r.jsx("p",{className:"text-gray-900 mt-1",children:t.length})]}),r.jsx(ct,{className:"w-10 h-10 text-green-600"})]})})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-gray-900 mb-4",children:"Réservations en attente"}),r.jsxs("div",{className:"space-y-3",children:[n.filter(i=>i.statut==="en_attente").map(i=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-900",children:i.nom}),r.jsxs("p",{className:"text-gray-600",children:[i.date," - ",i.heureDebut," à ",i.heureFin]})]}),r.jsx("span",{className:"px-3 py-1 bg-yellow-200 text-yellow-800 rounded-full",children:"En attente"})]},i.id)),n.filter(i=>i.statut==="en_attente").length===0&&r.jsx("p",{className:"text-gray-500 text-center py-4",children:"Aucune réservation en attente"})]})]})]})}function _s({formData:s,isEditing:e,onSubmit:t,onChange:n,onCancel:i}){return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-gray-900 mb-4",children:e?"Modifier le membre":"Nouveau membre"}),r.jsxs("form",{onSubmit:t,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{type:"text",name:"nom",placeholder:"Nom",value:s.nom,onChange:a=>n("nom",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"text",name:"prenom",placeholder:"Prénom",value:s.prenom,onChange:a=>n("prenom",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"email",name:"email",placeholder:"Email",value:s.email,onChange:a=>n("email",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"tel",name:"telephone",placeholder:"Téléphone",value:s.telephone,onChange:a=>n("telephone",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"text",name:"address",placeholder:"Adresse",value:s.adresse,onChange:a=>n("adresse",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsxs("select",{name:"gender",value:s.gender,onChange:a=>n("gender",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[r.jsx("option",{value:"",children:"Sélectionner le genre"}),r.jsx("option",{value:"M",children:"Masculin"}),r.jsx("option",{value:"F",children:"Féminin"}),r.jsx("option",{value:"OTHER",children:"Autre"})]}),r.jsx("input",{type:"date",name:"dateofbirth",placeholder:"Date de naissance",value:s.date_of_birth,onChange:a=>n("date_of_birth",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("textarea",{name:"medicalnote",placeholder:"Note médicale (optionnel)",value:s.medical_note,onChange:a=>n("medical_note",a.target.value),rows:3,className:"md:col-span-2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[r.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Annuler"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:e?"Modifier":"Ajouter"})]})]})]})}function Cs({membres:s,showAddMembre:e,membreForm:t,isEditing:n,onToggleForm:i,onFormChange:a,onSubmit:o,onEdit:l,onToggleStatus:u,onDelete:h,onCancel:f}){return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-gray-900",children:"Gestion des membres"}),r.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",title:"Ajouter un nouveau membre",children:[r.jsx(ke,{className:"w-5 h-5"}),"Ajouter un membre"]})]}),e&&r.jsx(_s,{formData:t,isEditing:n,onSubmit:o,onChange:a,onCancel:f}),r.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Nom"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Email"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Téléphone"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(c=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 text-gray-900",children:c.fullName}),r.jsx("td",{className:"px-6 py-4 text-gray-600",children:c.email}),r.jsx("td",{className:"px-6 py-4 text-gray-600",children:c.phone||"-"}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("span",{className:`px-3 py-1 rounded-full ${c.status==="ACTIVE"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.status==="ACTIVE"?"Actif":"Inactif"})}),r.jsx("td",{className:"px-6 py-4",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{title:"Modifier le membre",onClick:()=>l(c),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:r.jsx($e,{className:"w-4 h-4"})}),r.jsx("button",{title:"Changer le statut du membre",onClick:()=>u(c.id),className:"p-2 text-orange-600 hover:bg-orange-50 rounded-lg",children:r.jsx(dt,{className:"w-4 h-4"})}),r.jsx("button",{title:"Supprimer le membre",onClick:()=>h(c.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:r.jsx(Fe,{className:"w-4 h-4"})})]})})]},c.id))})]})})]})}function ks({formData:s,isEditing:e,onSubmit:t,onChange:n,onCancel:i}){return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-gray-900 mb-4",children:e?"Modifier le coach":"Nouveau coach"}),r.jsxs("form",{onSubmit:t,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{type:"text",name:"nom",placeholder:"Nom",value:s.nom,onChange:a=>n("nom",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"text",name:"prenom",placeholder:"Prénom",value:s.prenom,onChange:a=>n("prenom",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"email",name:"email",placeholder:"Email",value:s.email,onChange:a=>n("email",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"tel",name:"telephone",placeholder:"Téléphone",value:s.telephone,onChange:a=>n("telephone",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"text",name:"address",placeholder:"Adresse",value:s.adress,onChange:a=>n("adress",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsxs("select",{name:"gender",value:s.gender,onChange:a=>n("gender",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[r.jsx("option",{value:"",children:"Sélectionner le genre"}),r.jsx("option",{value:"M",children:"Masculin"}),r.jsx("option",{value:"F",children:"Féminin"}),r.jsx("option",{value:"OTHER",children:"Autre"})]}),r.jsx("input",{type:"text",name:"specialty",placeholder:"spécialité",value:s.specialty,onChange:a=>n("specialty",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("input",{type:"number",name:"Année_experience",placeholder:"Années d'expérience",value:s.experience_years,onChange:a=>n("experience_years",a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[r.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Annuler"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:e?"Modifier":"Ajouter"})]})]})]})}function Ss({coaches:s,showAddCoach:e,coachForm:t,isEditing:n,onToggleForm:i,onFormChange:a,onSubmit:o,onEdit:l,onToggleStatus:u,onDelete:h,onCancel:f}){return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-gray-900",children:"Gestion des coaches"}),r.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",title:"Ajouter un nouveau coach",children:[r.jsx(ke,{className:"w-5 h-5"}),"Ajouter un coach"]})]}),e&&r.jsx(ks,{formData:t,isEditing:n,onSubmit:o,onChange:a,onCancel:f}),r.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Nom"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Email"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Téléphone"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-gray-700",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(c=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 text-gray-900",children:c.fullName}),r.jsx("td",{className:"px-6 py-4 text-gray-600",children:c.email}),r.jsx("td",{className:"px-6 py-4 text-gray-600",children:c.phone||"-"}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("span",{className:`px-3 py-1 rounded-full ${c.status==="ACTIVE"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.status==="ACTIVE"?"Actif":"Inactif"})}),r.jsx("td",{className:"px-6 py-4",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{title:"Modifier le  coach",onClick:()=>l(c),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:r.jsx($e,{className:"w-4 h-4"})}),r.jsx("button",{title:"Changer le statut du coach",onClick:()=>u(c.id),className:"p-2 text-orange-600 hover:bg-orange-50 rounded-lg",children:r.jsx(dt,{className:"w-4 h-4"})}),r.jsx("button",{title:"Supprimer le coach",onClick:()=>h(c.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:r.jsx(Fe,{className:"w-4 h-4"})})]})})]},c.id))})]})})]})}function Es({seances:s,coaches:e,sports:t,showAddSeance:n,seanceForm:i,isEditing:a,onToggleForm:o,onFormChange:l,onSubmit:u,onEdit:h,onDelete:f,onCancel:c}){const g=y=>{if(!y)return"Non assigné";const A=e.find(E=>E.id===y);return A?A.fullName:"Coach inconnu"};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gestion des séances"}),r.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",title:"Créer une nouvelle séance",children:[r.jsx(ke,{className:"w-5 h-5"}),"Créer une séance"]})]}),n&&r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:a?"Modifier la séance":"Nouvelle séance"}),r.jsxs("form",{onSubmit:u,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de la séance"}),r.jsx("input",{type:"date",value:i.sessionDate,onChange:y=>l("sessionDate",y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Coach"}),r.jsxs("select",{value:i.idCoach,onChange:y=>l("idCoach",y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[r.jsx("option",{value:"",children:"Sélectionner un coach"}),e.map(y=>r.jsx("option",{value:y.id,children:y.fullName},y.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure de début"}),r.jsx("input",{type:"time",value:i.startTime,onChange:y=>l("startTime",y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure de fin"}),r.jsx("input",{type:"time",value:i.endTime,onChange:y=>l("endTime",y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID Salle (optionnel)"}),r.jsx("input",{type:"number",value:i.idRoom,onChange:y=>l("idRoom",y.target.value),placeholder:"ID de la salle",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID Équipe (optionnel)"}),r.jsx("input",{type:"number",value:i.idTeam,onChange:y=>l("idTeam",y.target.value),placeholder:"ID de l'équipe",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("div",{className:"md:col-span-2 flex gap-2",children:[r.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Annuler"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:a?"Mettre à jour":"Créer"})]})]})]}),r.jsx("div",{className:"space-y-4",children:s.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 text-center text-gray-500",children:"Aucune séance pour le moment. Créez-en une !"}):s.map(y=>r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Séance #",y.id]}),r.jsxs("span",{className:"text-gray-600",children:["avec ",g(y.idCoach)]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 font-medium",children:"Date"}),r.jsx("p",{children:new Date(y.sessionDate).toLocaleDateString("fr-FR")})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 font-medium",children:"Horaire"}),r.jsxs("p",{children:[y.startTime," - ",y.endTime]})]}),y.idRoom&&r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 font-medium",children:"Salle"}),r.jsxs("p",{children:["Salle #",y.idRoom]})]}),y.idTeam&&r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500 font-medium",children:"Équipe"}),r.jsxs("p",{children:["Équipe #",y.idTeam]})]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{title:"Modifier la séance",onClick:()=>h(y),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:r.jsx($e,{className:"w-4 h-4"})}),r.jsx("button",{title:"Supprimer la séance",onClick:()=>f(y.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:r.jsx(Fe,{className:"w-4 h-4"})})]})]})},y.id))})]})}function Ts({reservations:s,loading:e,onUpdateStatus:t}){const n=o=>{switch(o){case"demandee":return"En attente";case"acceptee":return"Acceptée";case"refusee":return"Refusée";case"reservee":return"Réservée";default:return o}},i=o=>{switch(o){case"acceptee":case"reservee":return"bg-green-100 text-green-800";case"refusee":return"bg-red-100 text-red-800";case"demandee":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},a=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit"});return e?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(ds,{className:"w-8 h-8 animate-spin text-blue-600"})}):r.jsxs("div",{className:"space-y-6",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gestion des réservations de terrain"}),s.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:r.jsx("p",{className:"text-gray-500",children:"Aucune réservation pour le moment"})}):r.jsx("div",{className:"space-y-4",children:s.map(o=>r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o.fullName}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Email"}),r.jsx("p",{children:o.email||"Non renseigné"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Téléphone"}),r.jsx("p",{children:o.phone})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Date"}),r.jsx("p",{children:a(o.reservationDate)})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Horaire"}),r.jsxs("p",{children:[o.startTime," - ",o.endTime]})]})]}),o.message&&r.jsxs("div",{className:"mt-4",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Message"}),r.jsx("p",{className:"text-sm text-gray-700 italic",children:o.message})]})]}),r.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium text-center whitespace-nowrap ${i(o.status)}`,children:n(o.status)}),o.status==="demandee"&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{title:"Accepter la réservation",onClick:()=>t(o.id,"acceptee"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:r.jsx(Gt,{className:"w-5 h-5"})}),r.jsx("button",{title:"Refuser la réservation",onClick:()=>t(o.id,"refusee"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:r.jsx(Kt,{className:"w-5 h-5"})})]})]})]})},o.id))})]})}class As{async getAll(e){console.log("Fetching messages for user:",e);const t=await R.get("/messages");return e?t.filter(n=>n.id_emetteur===e||n.id_destinataire===e):t}async getById(e){return R.get(`/messages/${e}`)}async sendToUser(e){return R.post("/messages",{...e,id_destinataires:[e.id_destinataire]})}async sendToUsers(e){const t=e.id_destinataires.map(n=>this.sendToUser({id_emetteur:e.id_emetteur,id_destinataire:n,contenu:e.contenu}));return Promise.all(t)}async create(e){return e.id_destinataires.length===1?this.sendToUser({id_emetteur:e.id_emetteur,id_destinataire:e.id_destinataires[0],contenu:e.contenu}):(await this.sendToUsers(e))[0]}async update(e,t){return R.put(`/messages/${e}`,t)}async delete(e){return R.delete(`/messages/${e}`)}async markAsSeen(e){return this.update(e,{statut:"seen"})}async getConversations(e,t){const n=await this.getAll(e);return this.groupMessagesIntoConversations(n,e,t)}groupMessagesIntoConversations(e,t,n){const i=new Map,a=[...e].sort((o,l)=>new Date(o.date_envoi).getTime()-new Date(l.date_envoi).getTime());for(const o of a){const l=o.id_emetteur===t?o.id_destinataire:o.id_emetteur,u=[t,l].sort((c,g)=>c-g),h=u.join("_");let f=i.get(h);if(!f){const c=n.find(g=>g.id===l);f={id:h,participants:u,participantNames:{[t]:n.find(g=>g.id===t)?.fullName||"Vous",[l]:c?.fullName||`Utilisateur ${l}`},participantRoles:{[t]:n.find(g=>g.id===t)?.role||"USER",[l]:c?.role||"USER"},messages:[],unreadCount:0,isGroup:!1},i.set(h,f)}f.messages.push(o),f.lastMessage=o,o.statut==="sent"&&o.id_emetteur!==t&&f.unreadCount++}return Array.from(i.values()).sort((o,l)=>!o.lastMessage||!l.lastMessage?0:new Date(l.lastMessage.date_envoi).getTime()-new Date(o.lastMessage.date_envoi).getTime())}}const fe=new As;function H(s){const e=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&e==="[object Date]"?new s.constructor(+s):typeof s=="number"||e==="[object Number]"||typeof s=="string"||e==="[object String]"?new Date(s):new Date(NaN)}function ne(s,e){return s instanceof Date?new s.constructor(e):new Date(e)}const ut=6048e5,Ms=864e5;let Os={};function Se(){return Os}function pe(s,e){const t=Se(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=H(s),a=i.getDay(),o=(a<n?7:0)+a-n;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function _e(s){return pe(s,{weekStartsOn:1})}function ht(s){const e=H(s),t=e.getFullYear(),n=ne(s,0);n.setFullYear(t+1,0,4),n.setHours(0,0,0,0);const i=_e(n),a=ne(s,0);a.setFullYear(t,0,4),a.setHours(0,0,0,0);const o=_e(a);return e.getTime()>=i.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function Qe(s){const e=H(s);return e.setHours(0,0,0,0),e}function Ge(s){const e=H(s),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+s-+t}function Rs(s,e){const t=Qe(s),n=Qe(e),i=+t-Ge(t),a=+n-Ge(n);return Math.round((i-a)/Ms)}function Ps(s){const e=ht(s),t=ne(s,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),_e(t)}function Ds(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function Ls(s){if(!Ds(s)&&typeof s!="number")return!1;const e=H(s);return!isNaN(Number(e))}function Bs(s){const e=H(s),t=ne(s,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const qs={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ws=(s,e,t)=>{let n;const i=qs[s];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function le(s){return(e={})=>{const t=e.width?String(e.width):s.defaultWidth;return s.formats[t]||s.formats[s.defaultWidth]}}const Is={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},$s={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Fs={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Vs={date:le({formats:Is,defaultWidth:"full"}),time:le({formats:$s,defaultWidth:"full"}),dateTime:le({formats:Fs,defaultWidth:"full"})},Hs={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ys=(s,e,t,n)=>Hs[s];function U(s){return(e,t)=>{const n=t?.context?String(t.context):"standalone";let i;if(n==="formatting"&&s.formattingValues){const o=s.defaultFormattingWidth||s.defaultWidth,l=t?.width?String(t.width):o;i=s.formattingValues[l]||s.formattingValues[o]}else{const o=s.defaultWidth,l=t?.width?String(t.width):s.defaultWidth;i=s.values[l]||s.values[o]}const a=s.argumentCallback?s.argumentCallback(e):e;return i[a]}}const Us={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},zs={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Xs={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Js={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Qs={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Gs={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ks=(s,e)=>{const t=Number(s),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Zs={ordinalNumber:Ks,era:U({values:Us,defaultWidth:"wide"}),quarter:U({values:zs,defaultWidth:"wide",argumentCallback:s=>s-1}),month:U({values:Xs,defaultWidth:"wide"}),day:U({values:Js,defaultWidth:"wide"}),dayPeriod:U({values:Qs,defaultWidth:"wide",formattingValues:Gs,defaultFormattingWidth:"wide"})};function z(s){return(e,t={})=>{const n=t.width,i=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],a=e.match(i);if(!a)return null;const o=a[0],l=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],u=Array.isArray(l)?tn(l,c=>c.test(o)):en(l,c=>c.test(o));let h;h=s.valueCallback?s.valueCallback(u):u,h=t.valueCallback?t.valueCallback(h):h;const f=e.slice(o.length);return{value:h,rest:f}}}function en(s,e){for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&e(s[t]))return t}function tn(s,e){for(let t=0;t<s.length;t++)if(e(s[t]))return t}function ft(s){return(e,t={})=>{const n=e.match(s.matchPattern);if(!n)return null;const i=n[0],a=e.match(s.parsePattern);if(!a)return null;let o=s.valueCallback?s.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;const l=e.slice(i.length);return{value:o,rest:l}}}const sn=/^(\d+)(th|st|nd|rd)?/i,nn=/\d+/i,rn={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},an={any:[/^b/i,/^(a|c)/i]},on={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},cn={any:[/1/i,/2/i,/3/i,/4/i]},ln={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},dn={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},un={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},hn={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},fn={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},mn={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},pn={ordinalNumber:ft({matchPattern:sn,parsePattern:nn,valueCallback:s=>parseInt(s,10)}),era:z({matchPatterns:rn,defaultMatchWidth:"wide",parsePatterns:an,defaultParseWidth:"any"}),quarter:z({matchPatterns:on,defaultMatchWidth:"wide",parsePatterns:cn,defaultParseWidth:"any",valueCallback:s=>s+1}),month:z({matchPatterns:ln,defaultMatchWidth:"wide",parsePatterns:dn,defaultParseWidth:"any"}),day:z({matchPatterns:un,defaultMatchWidth:"wide",parsePatterns:hn,defaultParseWidth:"any"}),dayPeriod:z({matchPatterns:fn,defaultMatchWidth:"any",parsePatterns:mn,defaultParseWidth:"any"})},gn={code:"en-US",formatDistance:Ws,formatLong:Vs,formatRelative:Ys,localize:Zs,match:pn,options:{weekStartsOn:0,firstWeekContainsDate:1}};function yn(s){const e=H(s);return Rs(e,Bs(e))+1}function xn(s){const e=H(s),t=+_e(e)-+Ps(e);return Math.round(t/ut)+1}function mt(s,e){const t=H(s),n=t.getFullYear(),i=Se(),a=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,o=ne(s,0);o.setFullYear(n+1,0,a),o.setHours(0,0,0,0);const l=pe(o,e),u=ne(s,0);u.setFullYear(n,0,a),u.setHours(0,0,0,0);const h=pe(u,e);return t.getTime()>=l.getTime()?n+1:t.getTime()>=h.getTime()?n:n-1}function bn(s,e){const t=Se(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,i=mt(s,e),a=ne(s,0);return a.setFullYear(i,0,n),a.setHours(0,0,0,0),pe(a,e)}function wn(s,e){const t=H(s),n=+pe(t,e)-+bn(t,e);return Math.round(n/ut)+1}function S(s,e){const t=s<0?"-":"",n=Math.abs(s).toString().padStart(e,"0");return t+n}const K={y(s,e){const t=s.getFullYear(),n=t>0?t:1-t;return S(e==="yy"?n%100:n,e.length)},M(s,e){const t=s.getMonth();return e==="M"?String(t+1):S(t+1,2)},d(s,e){return S(s.getDate(),e.length)},a(s,e){const t=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(s,e){return S(s.getHours()%12||12,e.length)},H(s,e){return S(s.getHours(),e.length)},m(s,e){return S(s.getMinutes(),e.length)},s(s,e){return S(s.getSeconds(),e.length)},S(s,e){const t=e.length,n=s.getMilliseconds(),i=Math.trunc(n*Math.pow(10,t-3));return S(i,e.length)}},ce={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ke={G:function(s,e,t){const n=s.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(s,e,t){if(e==="yo"){const n=s.getFullYear(),i=n>0?n:1-n;return t.ordinalNumber(i,{unit:"year"})}return K.y(s,e)},Y:function(s,e,t,n){const i=mt(s,n),a=i>0?i:1-i;if(e==="YY"){const o=a%100;return S(o,2)}return e==="Yo"?t.ordinalNumber(a,{unit:"year"}):S(a,e.length)},R:function(s,e){const t=ht(s);return S(t,e.length)},u:function(s,e){const t=s.getFullYear();return S(t,e.length)},Q:function(s,e,t){const n=Math.ceil((s.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return S(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(s,e,t){const n=Math.ceil((s.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return S(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(s,e,t){const n=s.getMonth();switch(e){case"M":case"MM":return K.M(s,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(s,e,t){const n=s.getMonth();switch(e){case"L":return String(n+1);case"LL":return S(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(s,e,t,n){const i=wn(s,n);return e==="wo"?t.ordinalNumber(i,{unit:"week"}):S(i,e.length)},I:function(s,e,t){const n=xn(s);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):S(n,e.length)},d:function(s,e,t){return e==="do"?t.ordinalNumber(s.getDate(),{unit:"date"}):K.d(s,e)},D:function(s,e,t){const n=yn(s);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):S(n,e.length)},E:function(s,e,t){const n=s.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(s,e,t,n){const i=s.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return S(a,2);case"eo":return t.ordinalNumber(a,{unit:"day"});case"eee":return t.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(i,{width:"short",context:"formatting"});case"eeee":default:return t.day(i,{width:"wide",context:"formatting"})}},c:function(s,e,t,n){const i=s.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return S(a,e.length);case"co":return t.ordinalNumber(a,{unit:"day"});case"ccc":return t.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(i,{width:"narrow",context:"standalone"});case"cccccc":return t.day(i,{width:"short",context:"standalone"});case"cccc":default:return t.day(i,{width:"wide",context:"standalone"})}},i:function(s,e,t){const n=s.getDay(),i=n===0?7:n;switch(e){case"i":return String(i);case"ii":return S(i,e.length);case"io":return t.ordinalNumber(i,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(s,e,t){const i=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(s,e,t){const n=s.getHours();let i;switch(n===12?i=ce.noon:n===0?i=ce.midnight:i=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(s,e,t){const n=s.getHours();let i;switch(n>=17?i=ce.evening:n>=12?i=ce.afternoon:n>=4?i=ce.morning:i=ce.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(s,e,t){if(e==="ho"){let n=s.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return K.h(s,e)},H:function(s,e,t){return e==="Ho"?t.ordinalNumber(s.getHours(),{unit:"hour"}):K.H(s,e)},K:function(s,e,t){const n=s.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):S(n,e.length)},k:function(s,e,t){let n=s.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):S(n,e.length)},m:function(s,e,t){return e==="mo"?t.ordinalNumber(s.getMinutes(),{unit:"minute"}):K.m(s,e)},s:function(s,e,t){return e==="so"?t.ordinalNumber(s.getSeconds(),{unit:"second"}):K.s(s,e)},S:function(s,e){return K.S(s,e)},X:function(s,e,t){const n=s.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return et(n);case"XXXX":case"XX":return se(n);case"XXXXX":case"XXX":default:return se(n,":")}},x:function(s,e,t){const n=s.getTimezoneOffset();switch(e){case"x":return et(n);case"xxxx":case"xx":return se(n);case"xxxxx":case"xxx":default:return se(n,":")}},O:function(s,e,t){const n=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Ze(n,":");case"OOOO":default:return"GMT"+se(n,":")}},z:function(s,e,t){const n=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Ze(n,":");case"zzzz":default:return"GMT"+se(n,":")}},t:function(s,e,t){const n=Math.trunc(s.getTime()/1e3);return S(n,e.length)},T:function(s,e,t){const n=s.getTime();return S(n,e.length)}};function Ze(s,e=""){const t=s>0?"-":"+",n=Math.abs(s),i=Math.trunc(n/60),a=n%60;return a===0?t+String(i):t+String(i)+e+S(a,2)}function et(s,e){return s%60===0?(s>0?"-":"+")+S(Math.abs(s)/60,2):se(s,e)}function se(s,e=""){const t=s>0?"-":"+",n=Math.abs(s),i=S(Math.trunc(n/60),2),a=S(n%60,2);return t+i+e+a}const tt=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},pt=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},vn=(s,e)=>{const t=s.match(/(P+)(p+)?/)||[],n=t[1],i=t[2];if(!i)return tt(s,e);let a;switch(n){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",tt(n,e)).replace("{{time}}",pt(i,e))},Nn={p:pt,P:vn},jn=/^D+$/,_n=/^Y+$/,Cn=["D","DD","YY","YYYY"];function kn(s){return jn.test(s)}function Sn(s){return _n.test(s)}function En(s,e,t){const n=Tn(s,e,t);if(console.warn(n),Cn.includes(s))throw new RangeError(n)}function Tn(s,e,t){const n=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const An=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Mn=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,On=/^'([^]*?)'?$/,Rn=/''/g,Pn=/[a-zA-Z]/;function st(s,e,t){const n=Se(),i=t?.locale??n.locale??gn,a=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,l=H(s);if(!Ls(l))throw new RangeError("Invalid time value");let u=e.match(Mn).map(f=>{const c=f[0];if(c==="p"||c==="P"){const g=Nn[c];return g(f,i.formatLong)}return f}).join("").match(An).map(f=>{if(f==="''")return{isToken:!1,value:"'"};const c=f[0];if(c==="'")return{isToken:!1,value:Dn(f)};if(Ke[c])return{isToken:!0,value:f};if(c.match(Pn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+c+"`");return{isToken:!1,value:f}});i.localize.preprocessor&&(u=i.localize.preprocessor(l,u));const h={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return u.map(f=>{if(!f.isToken)return f.value;const c=f.value;(!t?.useAdditionalWeekYearTokens&&Sn(c)||!t?.useAdditionalDayOfYearTokens&&kn(c))&&En(c,e,String(s));const g=Ke[c[0]];return g(l,c,i.localize,h)}).join("")}function Dn(s){const e=s.match(On);return e?e[1].replace(Rn,"'"):s}const Ln={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},Bn=(s,e,t)=>{let n;const i=Ln[s];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",String(e)),t?.addSuffix?t.comparison&&t.comparison>0?"dans "+n:"il y a "+n:n},qn={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},Wn={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},In={full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},$n={date:le({formats:qn,defaultWidth:"full"}),time:le({formats:Wn,defaultWidth:"full"}),dateTime:le({formats:In,defaultWidth:"full"})},Fn={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},Vn=(s,e,t,n)=>Fn[s],Hn={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},Yn={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},Un={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},zn={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},Xn={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},Jn=(s,e)=>{const t=Number(s),n=e?.unit;if(t===0)return"0";const i=["year","week","hour","minute","second"];let a;return t===1?a=n&&i.includes(n)?"ère":"er":a="ème",t+a},Qn=["MMM","MMMM"],Gn={preprocessor:(s,e)=>s.getDate()===1||!e.some(n=>n.isToken&&Qn.includes(n.value))?e:e.map(n=>n.isToken&&n.value==="do"?{isToken:!0,value:"d"}:n),ordinalNumber:Jn,era:U({values:Hn,defaultWidth:"wide"}),quarter:U({values:Yn,defaultWidth:"wide",argumentCallback:s=>s-1}),month:U({values:Un,defaultWidth:"wide"}),day:U({values:zn,defaultWidth:"wide"}),dayPeriod:U({values:Xn,defaultWidth:"wide"})},Kn=/^(\d+)(ième|ère|ème|er|e)?/i,Zn=/\d+/i,er={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},tr={any:[/^av/i,/^ap/i]},sr={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},nr={any:[/1/i,/2/i,/3/i,/4/i]},rr={narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},ir={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},ar={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},or={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},cr={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},lr={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},dr={ordinalNumber:ft({matchPattern:Kn,parsePattern:Zn,valueCallback:s=>parseInt(s)}),era:z({matchPatterns:er,defaultMatchWidth:"wide",parsePatterns:tr,defaultParseWidth:"any"}),quarter:z({matchPatterns:sr,defaultMatchWidth:"wide",parsePatterns:nr,defaultParseWidth:"any",valueCallback:s=>s+1}),month:z({matchPatterns:rr,defaultMatchWidth:"wide",parsePatterns:ir,defaultParseWidth:"any"}),day:z({matchPatterns:ar,defaultMatchWidth:"wide",parsePatterns:or,defaultParseWidth:"any"}),dayPeriod:z({matchPatterns:cr,defaultMatchWidth:"any",parsePatterns:lr,defaultParseWidth:"any"})},nt={code:"fr",formatDistance:Bn,formatLong:$n,formatRelative:Vn,localize:Gn,match:dr,options:{weekStartsOn:1,firstWeekContainsDate:4}};function ur({message:s,isOwn:e}){const[t,n]=w.useState(!1),i=st(s.createdAt,"HH:mm",{locale:nt}),a=st(s.createdAt,"dd MMMM yyyy",{locale:nt}),o=l=>{const u=/(https?:\/\/[^\s]+)/g;return l.split(u).map((f,c)=>f.match(u)?r.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-500 hover:text-blue-600",children:f},c):f)};return r.jsx("div",{className:`flex ${e?"justify-end":"justify-start"} mb-3`,children:r.jsxs("div",{className:`max-w-[70%] ${e?"items-end":"items-start"}`,children:[!e&&s.senderName&&r.jsxs("div",{className:"flex items-center gap-2 mb-1 ml-1",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.senderName}),s.senderRole&&r.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${s.senderRole==="ADMIN"?"bg-red-100 text-red-800":s.senderRole==="COACH"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.senderRole})]}),r.jsxs("div",{className:`relative px-4 py-3 rounded-2xl ${e?"bg-indigo-600 text-white rounded-br-none":"bg-white text-gray-800 border border-gray-200 rounded-bl-none"}`,onClick:()=>n(!t),children:[r.jsx("p",{className:"whitespace-pre-wrap break-words",children:o(s.text)}),r.jsxs("div",{className:`flex items-center justify-end mt-1 gap-2 ${t?"opacity-100":"opacity-0"}`,children:[r.jsx("span",{className:"text-xs opacity-75",children:i}),e&&r.jsx("span",{className:"flex items-center",children:s.read?r.jsx(as,{size:12,className:"text-white opacity-75"}):r.jsx(cs,{size:12,className:"text-white opacity-75"})})]})]}),t&&r.jsxs("div",{className:`text-xs text-gray-500 mt-1 ${e?"text-right":"text-left"}`,children:[a," à ",i]})]})})}function hr({onSendMessage:s,disabled:e=!1}){const[t,n]=w.useState(""),[i,a]=w.useState(!1),o=w.useRef(null);w.useEffect(()=>{if(o.current){o.current.style.height="auto";const h=Math.min(o.current.scrollHeight,120);o.current.style.height=`${h}px`}},[t]);const l=async()=>{if(!(!t.trim()||i||e))try{a(!0),await s(t),n(""),o.current&&(o.current.style.height="auto")}catch(h){console.error("Erreur envoi message:",h)}finally{a(!1)}},u=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),l())};return r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{ref:o,value:t,onChange:h=>n(h.target.value),onKeyDown:u,placeholder:"Tapez votre message...",disabled:e||i,className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none disabled:bg-gray-100 disabled:cursor-not-allowed",rows:1,style:{maxHeight:"120px",overflowY:"auto"}}),r.jsx("button",{type:"button",onClick:l,disabled:!t.trim()||i||e,className:`absolute right-2 bottom-2 p-2 rounded-full transition-colors ${t.trim()&&!i&&!e?"bg-indigo-600 text-white hover:bg-indigo-700":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,children:r.jsx(ms,{size:18,className:i?"animate-pulse":""})}),t.length>0&&r.jsxs("div",{className:"absolute right-14 bottom-3 text-xs text-gray-500",children:[t.length," caractères"]})]})}function fr({conversation:s,currentUser:e,allUsers:t,onSendMessage:n}){const[i,a]=w.useState(s.messages),[o,l]=w.useState(!1),u=w.useRef(null);w.useEffect(()=>{a(s.messages),(async()=>{s.messages.filter(y=>y.statut==="sent"&&y.id_emetteur!==e.id)})()},[s]),w.useEffect(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})},[i]);const h=async g=>{await n(s.id,g)},f=s.participants.find(g=>g!==e.id),c=f?t.find(g=>g.id===f):null;return s?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx("div",{className:"p-4 border-b flex items-center gap-3 bg-white",children:c?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${c.role==="ADMIN"?"bg-red-100":c.role==="COACH"?"bg-green-100":"bg-blue-100"}`,children:r.jsx("span",{className:`font-semibold ${c.role==="ADMIN"?"text-red-600":c.role==="COACH"?"text-green-600":"text-blue-600"}`,children:c.fullName.charAt(0).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("h2",{className:"font-medium text-gray-900",children:c.fullName}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${c.role==="ADMIN"?"bg-red-100 text-red-800":c.role==="COACH"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:c.role}),r.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[r.jsx("span",{className:`w-2 h-2 rounded-full ${c.status==="ACTIVE"?"bg-green-500":"bg-gray-400"}`}),c.status==="ACTIVE"?"En ligne":"Hors ligne"]})]})]})]}):r.jsx("div",{children:r.jsx("h2",{className:"font-medium text-gray-900",children:s.participantNames[s.participants.find(g=>g!==e.id)||0]})})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:o?r.jsx("div",{className:"flex justify-center items-center h-full",children:r.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):i.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[r.jsx("div",{className:"mb-4",children:r.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto",children:r.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})}),r.jsx("h3",{className:"font-medium mb-2",children:"Aucun message"}),r.jsx("p",{className:"text-sm",children:"Envoyez le premier message pour commencer la conversation"})]}):r.jsxs("div",{className:"space-y-4",children:[i.map((g,y)=>{const A=g.id_emetteur===e.id,E=A?e:t.find($=>$.id===g.id_emetteur),L=y===0||new Date(g.date_envoi).toDateString()!==new Date(i[y-1].date_envoi).toDateString();return r.jsxs("div",{children:[L&&r.jsx("div",{className:"flex justify-center my-4",children:r.jsx("div",{className:"bg-gray-200 rounded-full px-3 py-1 text-xs text-gray-600",children:new Date(g.date_envoi).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),r.jsx(ur,{message:{id:g.id_message.toString(),text:g.contenu,senderId:g.id_emetteur.toString(),createdAt:new Date(g.date_envoi),read:g.statut==="seen",senderName:E?.fullName||(A?"Vous":"Utilisateur"),senderRole:E?.role,isOwn:A},isOwn:A})]},g.id_message)}),r.jsx("div",{ref:u})]})}),r.jsx("div",{className:"p-4 border-t bg-white",children:r.jsx(hr,{onSendMessage:h})})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:"Sélectionnez une conversation"})}const mr=[{tag:"@everyone",label:"@everyone",description:"Tous les utilisateurs actifs"},{tag:"@coaches",label:"@coaches",description:"Tous les coaches actifs"},{tag:"@members",label:"@members",description:"Tous les membres actifs"}];function pr({admin:s,membres:e,coaches:t,onSend:n,onCancel:i}){const[a,o]=w.useState(""),[l,u]=w.useState(""),[h,f]=w.useState([]),[c,g]=w.useState([]),[y,A]=w.useState(!1),[E,L]=w.useState(0),$=w.useRef(null),re=[...e,...t,s];w.useEffect(()=>{if(!l.trim()){g([]),A(!1);return}const b=l.toLowerCase().trim();if(b.startsWith("@")){const m=mr.filter(v=>v.tag.toLowerCase().includes(b));g(m),A(m.length>0),L(0);return}const d=re.filter(m=>{if(m.id===s.id||m.status!=="ACTIVE"||h.some(C=>C.type==="user"&&C.id===m.id))return!1;const j=m.fullName.toLowerCase(),M=m.email.toLowerCase();return j.includes(b)||M.includes(b)});g(d),A(d.length>0),L(0)},[l,h]);const ie=b=>{"tag"in b?h.some(m=>m.type==="tag"&&m.tag===b.tag)||f([...h,{type:"tag",tag:b.tag,label:b.tag}]):h.some(m=>m.type==="user"&&m.id===b.id)||f([...h,{type:"user",id:b.id,label:b.fullName}]),u(""),A(!1),$.current?.focus()},ae=b=>{f(h.filter((d,m)=>m!==b))},ue=b=>{!y||c.length===0||(b.key==="ArrowDown"?(b.preventDefault(),L(d=>d<c.length-1?d+1:d)):b.key==="ArrowUp"?(b.preventDefault(),L(d=>d>0?d-1:0)):b.key==="Enter"?(b.preventDefault(),c[E]&&ie(c[E])):b.key==="Escape"&&A(!1))},oe=b=>{b.preventDefault(),a.trim()&&h.length>0&&n(h,a)};return r.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destinataires"}),r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"min-h-[42px] w-full px-3 py-2 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-indigo-500 flex flex-wrap gap-2 items-center",children:[h.map((b,d)=>r.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm",children:[r.jsx("span",{children:b.label}),r.jsx("button",{type:"button",onClick:()=>ae(d),className:"hover:bg-indigo-200 rounded-full p-0.5",children:r.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},d)),r.jsx("input",{ref:$,type:"text",value:l,onChange:b=>u(b.target.value),onKeyDown:ue,placeholder:h.length===0?"Tapez un nom, email ou @tag...":"",className:"flex-1 min-w-[200px] outline-none"})]}),y&&c.length>0&&r.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:c.map((b,d)=>{if("tag"in b)return r.jsxs("button",{type:"button",onClick:()=>ie(b),className:`w-full text-left px-4 py-3 hover:bg-indigo-50 ${d===E?"bg-indigo-50":""}`,children:[r.jsx("div",{className:"font-medium text-indigo-600",children:b.label}),r.jsx("div",{className:"text-sm text-gray-500",children:b.description})]},b.tag);{const m=b.role==="ADMIN"?"text-red-600":b.role==="COACH"?"text-green-600":"text-blue-600";return r.jsxs("button",{type:"button",onClick:()=>ie(b),className:`w-full text-left px-4 py-3 hover:bg-gray-50 ${d===E?"bg-gray-50":""}`,children:[r.jsx("div",{className:"font-medium text-gray-900",children:b.fullName}),r.jsx("div",{className:"text-sm text-gray-500",children:b.email}),r.jsx("div",{className:`text-xs uppercase ${m}`,children:b.role})]},b.id)}})})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),r.jsx("textarea",{value:a,onChange:b=>o(b.target.value),placeholder:"Contenu du message...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:4,required:!0})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"submit",disabled:h.length===0||!a.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Envoyer le message"}),r.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Annuler"})]})]})}const J=Object.create(null);J.open="0";J.close="1";J.ping="2";J.pong="3";J.message="4";J.upgrade="5";J.noop="6";const we=Object.create(null);Object.keys(J).forEach(s=>{we[J[s]]=s});const Pe={type:"error",data:"parser error"},gt=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",yt=typeof ArrayBuffer=="function",xt=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,Ve=({type:s,data:e},t,n)=>gt&&e instanceof Blob?t?n(e):rt(e,n):yt&&(e instanceof ArrayBuffer||xt(e))?t?n(e):rt(new Blob([e]),n):n(J[s]+(e||"")),rt=(s,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(s)};function it(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let Me;function gr(s,e){if(gt&&s.data instanceof Blob)return s.data.arrayBuffer().then(it).then(e);if(yt&&(s.data instanceof ArrayBuffer||xt(s.data)))return e(it(s.data));Ve(s,!1,t=>{Me||(Me=new TextEncoder),e(Me.encode(t))})}const at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",me=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<at.length;s++)me[at.charCodeAt(s)]=s;const yr=s=>{let e=s.length*.75,t=s.length,n,i=0,a,o,l,u;s[s.length-1]==="="&&(e--,s[s.length-2]==="="&&e--);const h=new ArrayBuffer(e),f=new Uint8Array(h);for(n=0;n<t;n+=4)a=me[s.charCodeAt(n)],o=me[s.charCodeAt(n+1)],l=me[s.charCodeAt(n+2)],u=me[s.charCodeAt(n+3)],f[i++]=a<<2|o>>4,f[i++]=(o&15)<<4|l>>2,f[i++]=(l&3)<<6|u&63;return h},xr=typeof ArrayBuffer=="function",He=(s,e)=>{if(typeof s!="string")return{type:"message",data:bt(s,e)};const t=s.charAt(0);return t==="b"?{type:"message",data:br(s.substring(1),e)}:we[t]?s.length>1?{type:we[t],data:s.substring(1)}:{type:we[t]}:Pe},br=(s,e)=>{if(xr){const t=yr(s);return bt(t,e)}else return{base64:!0,data:s}},bt=(s,e)=>{switch(e){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},wt="",wr=(s,e)=>{const t=s.length,n=new Array(t);let i=0;s.forEach((a,o)=>{Ve(a,!1,l=>{n[o]=l,++i===t&&e(n.join(wt))})})},vr=(s,e)=>{const t=s.split(wt),n=[];for(let i=0;i<t.length;i++){const a=He(t[i],e);if(n.push(a),a.type==="error")break}return n};function Nr(){return new TransformStream({transform(s,e){gr(s,t=>{const n=t.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{i=new Uint8Array(9);const a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}s.data&&typeof s.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Oe;function ye(s){return s.reduce((e,t)=>e+t.length,0)}function xe(s,e){if(s[0].length===e)return s.shift();const t=new Uint8Array(e);let n=0;for(let i=0;i<e;i++)t[i]=s[0][n++],n===s[0].length&&(s.shift(),n=0);return s.length&&n<s[0].length&&(s[0]=s[0].slice(n)),t}function jr(s,e){Oe||(Oe=new TextDecoder);const t=[];let n=0,i=-1,a=!1;return new TransformStream({transform(o,l){for(t.push(o);;){if(n===0){if(ye(t)<1)break;const u=xe(t,1);a=(u[0]&128)===128,i=u[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(ye(t)<2)break;const u=xe(t,2);i=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),n=3}else if(n===2){if(ye(t)<8)break;const u=xe(t,8),h=new DataView(u.buffer,u.byteOffset,u.length),f=h.getUint32(0);if(f>Math.pow(2,21)-1){l.enqueue(Pe);break}i=f*Math.pow(2,32)+h.getUint32(4),n=3}else{if(ye(t)<i)break;const u=xe(t,i);l.enqueue(He(a?u:Oe.decode(u),e)),n=0}if(i===0||i>s){l.enqueue(Pe);break}}}})}const vt=4;function P(s){if(s)return _r(s)}function _r(s){for(var e in P.prototype)s[e]=P.prototype[e];return s}P.prototype.on=P.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};P.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};P.prototype.off=P.prototype.removeListener=P.prototype.removeAllListeners=P.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+s],this};P.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};P.prototype.emitReserved=P.prototype.emit;P.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};P.prototype.hasListeners=function(s){return!!this.listeners(s).length};const Ee=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),I=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Cr="arraybuffer";function Nt(s,...e){return e.reduce((t,n)=>(s.hasOwnProperty(n)&&(t[n]=s[n]),t),{})}const kr=I.setTimeout,Sr=I.clearTimeout;function Te(s,e){e.useNativeTimers?(s.setTimeoutFn=kr.bind(I),s.clearTimeoutFn=Sr.bind(I)):(s.setTimeoutFn=I.setTimeout.bind(I),s.clearTimeoutFn=I.clearTimeout.bind(I))}const Er=1.33;function Tr(s){return typeof s=="string"?Ar(s):Math.ceil((s.byteLength||s.size)*Er)}function Ar(s){let e=0,t=0;for(let n=0,i=s.length;n<i;n++)e=s.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function jt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Mr(s){let e="";for(let t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e}function Or(s){let e={},t=s.split("&");for(let n=0,i=t.length;n<i;n++){let a=t[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class Rr extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Ye extends P{constructor(e){super(),this.writable=!1,Te(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new Rr(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=He(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Mr(e);return t.length?"?"+t:""}}class Pr extends Ye{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};vr(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,wr(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=jt()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let _t=!1;try{_t=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Dr=_t;function Lr(){}class Br extends Pr{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let n=location.port;n||(n=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class X extends P{constructor(e,t,n){super(),this.createRequest=e,Te(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const t=Nt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=X.requestsCount++,X.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Lr,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete X.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}X.requestsCount=0;X.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ot);else if(typeof addEventListener=="function"){const s="onpagehide"in I?"pagehide":"unload";addEventListener(s,ot,!1)}}function ot(){for(let s in X.requests)X.requests.hasOwnProperty(s)&&X.requests[s].abort()}const qr=(function(){const s=Ct({xdomain:!1});return s&&s.responseType!==null})();class Wr extends Br{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=qr&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new X(Ct,this.uri(),e)}}function Ct(s){const e=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Dr))return new XMLHttpRequest}catch{}if(!e)try{return new I[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const kt=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ir extends Ye{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=kt?{}:Nt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Ve(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}i&&Ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=jt()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Re=I.WebSocket||I.MozWebSocket;class $r extends Ir{createSocket(e,t,n){return kt?new Re(e,t,n):t?new Re(e,t):new Re(e)}doWrite(e,t){this.ws.send(t)}}class Fr extends Ye{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=jr(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=Nr();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const a=()=>{n.read().then(({done:l,value:u})=>{l||(this.onPacket(u),a())}).catch(l=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then(()=>{i&&Ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Vr={websocket:$r,webtransport:Fr,polling:Wr},Hr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Yr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function De(s){if(s.length>8e3)throw"URI too long";const e=s,t=s.indexOf("["),n=s.indexOf("]");t!=-1&&n!=-1&&(s=s.substring(0,t)+s.substring(t,n).replace(/:/g,";")+s.substring(n,s.length));let i=Hr.exec(s||""),a={},o=14;for(;o--;)a[Yr[o]]=i[o]||"";return t!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=Ur(a,a.path),a.queryKey=zr(a,a.query),a}function Ur(s,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function zr(s,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(t[i]=a)}),t}const Le=typeof addEventListener=="function"&&typeof removeEventListener=="function",ve=[];Le&&addEventListener("offline",()=>{ve.forEach(s=>s())},!1);class Z extends P{constructor(e,t){if(super(),this.binaryType=Cr,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const n=De(e);t.hostname=n.host,t.secure=n.protocol==="https"||n.protocol==="wss",t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=De(t.host).host);Te(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Or(this.opts.query)),Le&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ve.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=vt,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Z.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Z.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=Tr(i)),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Ee(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Z.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Le&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=ve.indexOf(this._offlineEventListener);n!==-1&&ve.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Z.protocol=vt;class Xr extends Z{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Z.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",c=>{if(!n)if(c.type==="pong"&&c.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Z.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(f(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const g=new Error("probe error");g.transport=t.name,this.emitReserved("upgradeError",g)}}))};function a(){n||(n=!0,f(),t.close(),t=null)}const o=c=>{const g=new Error("probe error: "+c);g.transport=t.name,a(),this.emitReserved("upgradeError",g)};function l(){o("transport closed")}function u(){o("socket closed")}function h(c){t&&c.name!==t.name&&a()}const f=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",l),this.off("close",u),this.off("upgrading",h)};t.once("open",i),t.once("error",o),t.once("close",l),this.once("close",u),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let Jr=class extends Xr{constructor(e,t={}){const n=typeof e=="object"?e:t;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>Vr[i]).filter(i=>!!i)),super(e,n)}};function Qr(s,e="",t){let n=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),n=De(s)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(t&&t.port===n.port?"":":"+n.port),n}const Gr=typeof ArrayBuffer=="function",Kr=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,St=Object.prototype.toString,Zr=typeof Blob=="function"||typeof Blob<"u"&&St.call(Blob)==="[object BlobConstructor]",ei=typeof File=="function"||typeof File<"u"&&St.call(File)==="[object FileConstructor]";function Ue(s){return Gr&&(s instanceof ArrayBuffer||Kr(s))||Zr&&s instanceof Blob||ei&&s instanceof File}function Ne(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,n=s.length;t<n;t++)if(Ne(s[t]))return!0;return!1}if(Ue(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Ne(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&Ne(s[t]))return!0;return!1}function ti(s){const e=[],t=s.data,n=s;return n.data=Be(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Be(s,e){if(!s)return s;if(Ue(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let n=0;n<s.length;n++)t[n]=Be(s[n],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=Be(s[n],e));return t}return s}function si(s,e){return s.data=qe(s.data,e),delete s.attachments,s}function qe(s,e){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<e.length)return e[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=qe(s[t],e);else if(typeof s=="object")for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&(s[t]=qe(s[t],e));return s}const Et=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ni=5;var N;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class ri{constructor(e){this.replacer=e}encode(e){return(e.type===N.EVENT||e.type===N.ACK)&&Ne(e)?this.encodeAsBinary({type:e.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===N.BINARY_EVENT||e.type===N.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ti(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class ze extends P{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===N.BINARY_EVENT;n||t.type===N.BINARY_ACK?(t.type=n?N.EVENT:N.ACK,this.reconstructor=new ii(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Ue(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(N[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===N.BINARY_EVENT||n.type===N.BINARY_ACK){const a=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(a,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const a=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(a,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const a=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(a,t+1))}if(e.charAt(++t)){const a=this.tryParse(e.substr(t));if(ze.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case N.CONNECT:return Ce(t);case N.DISCONNECT:return t===void 0;case N.CONNECT_ERROR:return typeof t=="string"||Ce(t);case N.EVENT:case N.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Et.indexOf(t[0])===-1);case N.ACK:case N.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ii{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=si(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ai(s){return typeof s=="string"}const oi=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s};function ci(s){return s===void 0||oi(s)}function Ce(s){return Object.prototype.toString.call(s)==="[object Object]"}function li(s,e){switch(s){case N.CONNECT:return e===void 0||Ce(e);case N.DISCONNECT:return e===void 0;case N.EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&Et.indexOf(e[0])===-1);case N.ACK:return Array.isArray(e);case N.CONNECT_ERROR:return typeof e=="string"||Ce(e);default:return!1}}function di(s){return ai(s.nsp)&&ci(s.id)&&li(s.type,s.data)}const ui=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ze,Encoder:ri,get PacketType(){return N},isPacketValid:di,protocol:ni},Symbol.toStringTag,{value:"Module"}));function V(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const hi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Tt extends P{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[V(e,"open",this.onopen.bind(this)),V(e,"packet",this.onpacket.bind(this)),V(e,"error",this.onerror.bind(this)),V(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,i,a;if(hi.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:N.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const f=this.ids++,c=t.pop();this._registerAckCallback(f,c),o.id=f}const l=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,u=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!l||(u?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);t.call(this,new Error("operation has timed out"))},i),o=(...l)=>{this.io.clearTimeoutFn(a),t.apply(this,l)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((n,i)=>{const a=(o,l)=>o?i(o):n(l);a.withError=!0,t.push(a),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...a)=>(this._queue[0],i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:N.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case N.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(e);break;case N.ACK:case N.BINARY_ACK:this.onack(e);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:N.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function de(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}de.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=(Math.floor(e*10)&1)==0?s-t:s+t}return Math.min(s,this.max)|0};de.prototype.reset=function(){this.attempts=0};de.prototype.setMin=function(s){this.ms=s};de.prototype.setMax=function(s){this.max=s};de.prototype.setJitter=function(s){this.jitter=s};class We extends P{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Te(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new de({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||ui;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Jr(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=V(t,"open",function(){n.onopen(),e&&e()}),a=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},o=V(t,"error",a);if(this._timeout!==!1){const l=this._timeout,u=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),t.close()},l);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(V(e,"ping",this.onping.bind(this)),V(e,"data",this.ondata.bind(this)),V(e,"error",this.onerror.bind(this)),V(e,"close",this.onclose.bind(this)),V(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ee(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Tt(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const he={};function je(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=Qr(s,e.path||"/socket.io"),n=t.source,i=t.id,a=t.path,o=he[i]&&a in he[i].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let u;return l?u=new We(n,e):(he[i]||(he[i]=new We(n,e)),u=he[i]),t.query&&!e.query&&(e.query=t.queryKey),u.socket(t.path,e)}Object.assign(je,{Manager:We,Socket:Tt,io:je,connect:je});const D=je("http://localhost:3000",{autoConnect:!1,auth:{token:localStorage.getItem("auth_token")}});function fi({admin:s,membres:e,coaches:t}){const[n,i]=w.useState([]),[a,o]=w.useState(null),[l,u]=w.useState(!0),[h,f]=w.useState(""),[c,g]=w.useState("conversations"),[y,A]=w.useState(!1),E=[...e,...t,s];w.useEffect(()=>{const d=localStorage.getItem("auth_token")||"",m=d.startsWith("Bearer ")?d.slice(7):d;console.log("[socket] token length",m.length),D.auth={token:m},D.connected||D.connect();const v=()=>console.log("[socket] connected",D.id),j=T=>console.log("[socket] disconnected",T),M=T=>console.log("[socket] connect_error",T.message),C=T=>{if(console.log("[socket] incoming",T),T.id_emetteur!==s.id&&T.id_destinataire!==s.id)return;const ee=T.id_emetteur===s.id?T.id_destinataire:T.id_emetteur,te=[s.id,ee].sort((O,B)=>O-B).join("_");i(O=>{const B=O.find(F=>F.id===te);if(!B){const F=E.find(G=>G.id===ee);return[{id:te,participants:[s.id,ee].sort((G,Ae)=>G-Ae),participantNames:{[s.id]:s.fullName,[ee]:F?.fullName||`Utilisateur ${ee}`},participantRoles:{[s.id]:s.role,[ee]:F?.role||"USER"},messages:[T],lastMessage:T,unreadCount:T.id_destinataire===s.id?1:0,isGroup:!1},...O]}return[{...B,messages:[...B.messages,T],lastMessage:T,unreadCount:T.id_destinataire===s.id&&a?.id!==te?B.unreadCount+1:B.unreadCount},...O.filter(F=>F.id!==te)]}),o(O=>!O||O.id!==te?O:{...O,messages:[...O.messages,T],lastMessage:T})};return D.on("connect",v),D.on("disconnect",j),D.on("connect_error",M),D.on("message:new",C),D.on("message:sent",C),()=>{D.off("connect",v),D.off("disconnect",j),D.off("connect_error",M),D.off("message:new",C),D.off("message:sent",C)}},[s.id,s.fullName,s.role,E,a?.id]),w.useEffect(()=>{const d=async()=>{try{u(!0);const v=await fe.getConversations(s.id,E);i(v)}catch(v){console.error("Erreur chargement conversations:",v)}finally{u(!1)}};d();const m=setInterval(d,3e4*10);return()=>clearInterval(m)},[s.id]);const L=h.trim()===""?E.filter(d=>d.id!==s.id):E.filter(d=>{if(d.id===s.id)return!1;const m=h.toLowerCase();return d.fullName.toLowerCase().includes(m)||d.email.toLowerCase().includes(m)||d.role.toLowerCase().includes(m)}),$=h.trim()===""?n:n.filter(d=>{const m=h.toLowerCase();return d.participants.some(v=>{if(v===s.id)return!1;const j=E.find(M=>M.id===v);return j?.fullName.toLowerCase().includes(m)||j?.email.toLowerCase().includes(m)})}),re=async d=>{const m=n.find(C=>C.participants.includes(s.id)&&C.participants.includes(d));if(m){o(m),A(!1);return}const v=E.find(C=>C.id===d),j=[s.id,d].sort((C,T)=>C-T),M={id:j.join("_"),participants:j,participantNames:{[s.id]:s.fullName,[d]:v?.fullName||`Utilisateur ${d}`},participantRoles:{[s.id]:s.role,[d]:v?.role||"USER"},messages:[],unreadCount:0,isGroup:!1};i(C=>[M,...C]),o(M),A(!1)},ie=async(d,m)=>{if(!m.trim()||!a)return;const v=a.participants.find(j=>j!==s.id);if(v)try{const j=await fe.sendToUser({id_emetteur:s.id,id_destinataire:v,contenu:m}),M={...a,messages:[...a.messages,j],lastMessage:j};o(M),i(C=>C.map(T=>T.id===d?M:T))}catch(j){console.error("Erreur envoi message:",j),alert("Erreur lors de l'envoi du message")}},ae=async(d,m)=>{if(!(!m.trim()||d.length===0))try{const v=new Set;d.forEach(M=>{if(M.type==="user"&&M.id)v.add(M.id);else if(M.type==="tag")switch(M.tag){case"@everyone":E.forEach(C=>{C.status==="ACTIVE"&&C.id!==s.id&&v.add(C.id)});break;case"@coaches":t.forEach(C=>{C.status==="ACTIVE"&&v.add(C.id)});break;case"@members":e.forEach(C=>{C.status==="ACTIVE"&&v.add(C.id)});break}}),await fe.sendToUsers({id_emetteur:s.id,id_destinataires:Array.from(v),contenu:m}),alert(`Message envoyé à ${v.size} destinataire(s)`),A(!1);const j=await fe.getConversations(s.id,E);i(j)}catch(v){console.error("Erreur envoi message avec tags:",v),alert("Erreur lors de l'envoi du message")}},ue=d=>{const m=d.participants.find(j=>j!==s.id);return m?E.find(j=>j.id===m)?.fullName||`Utilisateur ${m}`:"Conversation de groupe"},oe=d=>{const m=d.participants.find(j=>j!==s.id);return m?E.find(j=>j.id===m)?.role||"USER":""},b=d=>{const m=new Date(d),v=new Date;return m.toDateString()===v.toDateString()?m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):m.toLocaleDateString([],{month:"short",day:"numeric"})};return r.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Messagerie"}),r.jsxs("button",{onClick:()=>A(!y),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2",children:[r.jsx(ke,{size:18}),"Nouveau message"]})]})}),y&&r.jsx("div",{className:"p-6 border-b bg-gray-50",children:r.jsx(pr,{admin:s,membres:e,coaches:t,onSend:ae,onCancel:()=>A(!1)})}),r.jsxs("div",{className:"flex h-[600px]",children:[r.jsxs("div",{className:"w-[26rem] lg:w-[30rem] border-r border-gray-200 flex flex-col ",children:[r.jsx("div",{className:"p-4 border-b",children:r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",placeholder:"Rechercher une conversation ou un utilisateur...",value:h,onChange:d=>f(d.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx(hs,{size:18,className:"absolute left-3 top-2.5 text-gray-400"}),h&&r.jsx("button",{onClick:()=>f(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:r.jsx(ss,{size:18})})]})}),r.jsxs("div",{className:"flex border-b",children:[r.jsx("button",{className:`flex-1 py-3 text-center font-medium ${c==="conversations"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>g("conversations"),children:r.jsxs("div",{className:"flex justify-center items-center gap-2",children:[r.jsx(be,{size:18}),r.jsx("span",{children:"Conversations"})]})}),r.jsx("button",{className:`flex-1 py-3 text-center font-medium ${c==="users"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>g("users"),children:r.jsxs("div",{className:"flex justify-center items-center gap-2",children:[r.jsx(Ie,{size:18}),r.jsx("span",{children:"Utilisateurs"})]})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:l?r.jsx("div",{className:"flex justify-center items-center h-32",children:r.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"})}):c==="conversations"?$.length>0?r.jsx("ul",{children:$.map(d=>{const m=ue(d),v=oe(d),j=d.lastMessage;return r.jsx("li",{className:`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${a?.id===d.id?"bg-indigo-50":""}`,onClick:()=>o(d),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`h-12 w-12 rounded-full flex items-center justify-center ${v==="ADMIN"?"bg-red-100":v==="COACH"?"bg-green-100":"bg-blue-100"}`,children:r.jsx("span",{className:`font-semibold ${v==="ADMIN"?"text-red-600":v==="COACH"?"text-green-600":"text-blue-600"}`,children:m.charAt(0).toUpperCase()})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("h3",{className:"font-medium truncate",children:m}),j&&r.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:b(j.date_envoi)})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${v==="ADMIN"?"bg-red-100 text-red-800":v==="COACH"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:v}),d.unreadCount>0&&r.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:d.unreadCount})]}),r.jsx("p",{className:"text-sm text-gray-500 truncate mt-1",children:j?.contenu||"Aucun message"})]})]})},d.id)})}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center text-gray-500",children:[r.jsx(be,{size:48,className:"mb-4 text-gray-300"}),r.jsx("p",{className:"font-medium mb-2",children:"Aucune conversation"}),r.jsx("p",{className:"text-sm",children:"Commencez une nouvelle conversation"})]}):r.jsx("ul",{children:L.map(d=>r.jsx("li",{className:"p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>re(d.id),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`h-12 w-12 rounded-full flex items-center justify-center ${d.role==="ADMIN"?"bg-red-100":d.role==="COACH"?"bg-green-100":"bg-blue-100"}`,children:r.jsx("span",{className:`font-semibold ${d.role==="ADMIN"?"text-red-600":d.role==="COACH"?"text-green-600":"text-blue-600"}`,children:d.fullName.charAt(0).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium",children:d.fullName}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("span",{className:"text-sm text-gray-500",children:d.email}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${d.role==="ADMIN"?"bg-red-100 text-red-800":d.role==="COACH"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:d.role})]}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:d.status==="ACTIVE"?r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"En ligne"]}):r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Hors ligne"]})})]})]})},d.id))})})]}),r.jsx("div",{className:"flex-1 flex flex-col",children:a?r.jsx(fr,{conversation:a,currentUser:s,allUsers:E,onSendMessage:ie}):r.jsx("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-8 text-gray-500",children:r.jsxs("div",{className:"max-w-md",children:[r.jsx("div",{className:"h-24 w-24 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center",children:r.jsx(be,{size:48,className:"text-gray-300"})}),r.jsx("h3",{className:"text-xl font-medium mb-2 text-gray-800",children:"Bienvenue dans la messagerie"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Sélectionnez une conversation existante ou démarrez-en une nouvelle avec un utilisateur"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsx("button",{onClick:()=>g("users"),className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Voir les utilisateurs"}),r.jsx("button",{onClick:()=>A(!0),className:"px-6 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors",children:"Envoyer un message groupé"})]})]})})})]})]})}function xi(){const{user:s,logout:e}=Zt();console.log("Admin user:",s);const t=es(),[n,i]=w.useState("dashboard"),[a,o]=w.useState(!1),[l,u]=w.useState(!1),[h,f]=w.useState(!1),[c,g]=w.useState([]),[y,A]=w.useState([]),[E,L]=w.useState([]),[$,re]=w.useState([]),[ie,ae]=w.useState(!0),[ue,oe]=w.useState(!1),[b,d]=w.useState(null),[m,v]=w.useState(null),[j,M]=w.useState(null),[C,T]=w.useState(null),[ee,te]=w.useState([]),[O,B]=w.useState({nom:"",prenom:"",email:"",telephone:"",date_of_birth:"",adress:"",gender:"",medical_note:""}),[q,F]=w.useState({nom:"",prenom:"",email:"",telephone:"",adress:"",gender:"",specialty:"",diploma:"",experience_years:"0"}),[W,G]=w.useState({sessionDate:"",startTime:"",endTime:"",idCoach:"",idRoom:"",idTeam:""});w.useEffect(()=>{(async()=>{try{ae(!0),d(null);const[x,_,k,Jt,Xe]=await Promise.all([Y.getMembers(),Y.getCoaches(),ge.getAll(),Je.getAll(),fe.getAll()]);console.log("Loaded messages:",Xe),g(x),A(_),L(k),re(Jt),te(Xe)}catch(x){console.error("Erreur lors du chargement des données:",x),d("Erreur lors du chargement des données")}finally{ae(!1)}})()},[]);const Ae=["Football","Basketball","Tennis","Volleyball","Handball"],At=async p=>{p.preventDefault();const x={full_name:`${O.prenom} ${O.nom}`,email:O.email,phone:O.telephone,date_of_birth:O.date_of_birth||void 0,gender:O.gender||void 0,medical_note:O.medical_note||void 0,role:"MEMBER"};try{if(m){const _=await Y.update(m.id,x);g(c.map(k=>k.id===_.id?_:k))}else{const _=await Y.create({...x,password:"defaultPassword123"});g([...c,_])}o(!1),v(null),B({nom:"",prenom:"",email:"",telephone:"",date_of_birth:"",adress:"",gender:"",medical_note:""})}catch{alert("Erreur lors de l'enregistrement")}},Mt=p=>{const[x,..._]=p.fullName.split(" "),k=_.join(" ");B({nom:k,prenom:x,email:p.email||"",telephone:p.phone||"",date_of_birth:p.date_of_birth||"",gender:p.gender||"",adress:p.adress||"",medical_note:p.medical_note||""}),v(p),o(!0)},Ot=(p,x)=>{B({...O,[p]:x})},Rt=()=>{o(!1),v(null),B({nom:"",prenom:"",email:"",telephone:"",date_of_birth:"",adress:"",gender:"",medical_note:""})},Pt=async p=>{try{const x=c.find(k=>k.id===p);if(!x)return;const _=x.status==="ACTIVE"?"INACTIVE":"ACTIVE";await Y.update(p,{status:_}),g(c.map(k=>k.id===p?{...k,status:_}:k))}catch(x){console.error("Erreur lors de la modification du statut:",x),alert("Erreur lors de la modification du statut")}},Dt=async p=>{if(confirm("Voulez-vous vraiment supprimer ce membre ?"))try{await Y.delete(p),g(c.filter(x=>x.id!==p))}catch(x){console.error("Erreur lors de la suppression:",x),alert("Erreur lors de la suppression du membre")}},Lt=async p=>{p.preventDefault();const x={full_name:`${q.prenom} ${q.nom}`,email:q.email,phone:q.telephone||"",adress:q.adress||"",gender:q.gender||"",specialty:q.specialty||"",diploma:q.diploma||"",experience_years:parseInt(q.experience_years)||0,role:"COACH"};try{if(j){const _=await Y.update(j.id,x);A(y.map(k=>k.id===_.id?_:k))}else{const _=await Y.create({...x,password:"defaultPassword123"});A([...y,_])}u(!1),M(null),F({nom:"",prenom:"",email:"",telephone:"",adress:"",gender:"",specialty:"",diploma:"",experience_years:"0"})}catch{alert("Erreur lors de l'enregistrement")}},Bt=p=>{const[x,..._]=p.fullName.split(" "),k=_.join(" ");F({nom:k,prenom:x,email:p.email||"",telephone:p.phone||"",gender:p.gender||"",adress:p.adress||"",experience_years:"",specialty:"",diploma:""}),M(p),u(!0)},qt=async p=>{try{const x=y.find(k=>k.id===p);if(!x)return;const _=x.status==="ACTIVE"?"INACTIVE":"ACTIVE";await Y.update(p,{status:_}),A(y.map(k=>k.id===p?{...k,status:_}:k))}catch(x){console.error("Erreur lors de la modification du statut:",x),alert("Erreur lors de la modification du statut")}},Wt=(p,x)=>{F({...q,[p]:x})},It=()=>{u(!1),M(null),F({nom:"",prenom:"",email:"",telephone:"",adress:"",gender:"",experience_years:"",specialty:"",diploma:""})},$t=async p=>{if(confirm("Voulez-vous vraiment supprimer ce coach ?"))try{await Y.delete(parseInt(p)),A(y.filter(x=>x.id!==parseInt(p)))}catch(x){console.error("Erreur lors de la suppression:",x),alert("Erreur lors de la suppression du coach")}},Ft=async p=>{p.preventDefault();const x={session_date:W.sessionDate,start_time:W.startTime,end_time:W.endTime,id_coach:W.idCoach?parseInt(W.idCoach):void 0,id_room:W.idRoom?parseInt(W.idRoom):void 0,id_team:W.idTeam?parseInt(W.idTeam):void 0};try{if(C){const _=await ge.update(C.id,x);L(E.map(k=>k.id===_.id?_:k))}else{const _=await ge.create(x);L([...E,_])}f(!1),T(null),G({sessionDate:"",startTime:"",endTime:"",idCoach:"",idRoom:"",idTeam:""})}catch(_){console.error("Erreur lors de l'enregistrement de la séance:",_),alert("Erreur lors de l'enregistrement de la séance")}},Vt=p=>{G({sessionDate:p.sessionDate,startTime:p.startTime,endTime:p.endTime,idCoach:p.idCoach?.toString()||"",idRoom:p.idRoom?.toString()||"",idTeam:p.idTeam?.toString()||""}),T(p),f(!0)},Ht=(p,x)=>{G({...W,[p]:x})},Yt=()=>{f(!1),T(null),G({sessionDate:"",startTime:"",endTime:"",idCoach:"",idRoom:"",idTeam:""})},Ut=async p=>{if(confirm("Voulez-vous vraiment supprimer cette séance ?"))try{await ge.delete(p),L(E.filter(x=>x.id!==p))}catch(x){console.error("Erreur lors de la suppression:",x),alert("Erreur lors de la suppression de la séance")}},zt=async(p,x)=>{try{oe(!0);const _=await Je.update(p,{status:x});re($.map(k=>k.id===p?_:k)),alert(`Réservation ${x==="acceptee"?"acceptée":"refusée"} avec succès`)}catch(_){console.error("Erreur lors de la mise à jour du statut:",_),alert("Erreur lors de la mise à jour du statut de la réservation")}finally{oe(!1)}},Xt=()=>{e(),t("/")};return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(vs,{userName:`${s?.fullName}`,onLogout:Xt}),r.jsx("div",{className:"w-full px-4 py-4",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[r.jsx(Ns,{currentView:n,onViewChange:i}),r.jsxs("main",{className:"lg:col-span-3",children:[n==="dashboard"&&r.jsx(js,{membres:c,coaches:y,seances:E,reservations:$}),n==="membres"&&r.jsx(Cs,{membres:c,showAddMembre:a,membreForm:O,isEditing:!!m,onToggleForm:()=>o(!a),onFormChange:Ot,onSubmit:At,onEdit:Mt,onToggleStatus:Pt,onDelete:Dt,onCancel:Rt}),n==="coaches"&&r.jsx(Ss,{coaches:y,showAddCoach:l,coachForm:q,isEditing:!!j,onToggleForm:()=>u(!l),onFormChange:Wt,onSubmit:Lt,onEdit:Bt,onToggleStatus:qt,onDelete:$t,onCancel:It}),n==="seances"&&r.jsx(Es,{seances:E,coaches:y,sports:Ae,showAddSeance:h,seanceForm:W,isEditing:!!C,onToggleForm:()=>f(!h),onFormChange:Ht,onSubmit:Ft,onEdit:Vt,onDelete:Ut,onCancel:Yt}),n==="reservations"&&r.jsx(Ts,{reservations:$,loading:ue,onUpdateStatus:zt}),n==="messages"&&r.jsx(fi,{admin:s,membres:c,coaches:y})]})]})})]})}export{xi as AdminDashboard};
